# How I Fixed Random Freezes on My ASUS ROG G14 2025 with RTX 5070 Ti Running Ubuntu 24.04

*A comprehensive guide to solving hybrid graphics nightmares on Linux*

---

![ASUS ROG Zephyrus G14 2025](https://placeholder-for-your-image.com)
*The beast that refused to be tamed... until now.*

---

## The Nightmare Begins

Picture this: You just unboxed your shiny new ASUS ROG Zephyrus G14 2025 ‚Äî the model with AMD's latest Ryzen 9 8945HS and NVIDIA's brand-new RTX 5070 Ti. You're excited to run your machine learning workloads, computer vision projects, maybe some seismic data processing (okay, maybe that's just me). You install Ubuntu 24.04, boot it up, and...

**Everything freezes. Randomly.**

The cursor won't move. The keyboard is dead. Your only option? The hard reset button. But here's the weird part: when you connect an external monitor, *it keeps working perfectly* while your internal display is frozen solid.

Sound familiar? If you've stumbled upon this article, chances are you're living this nightmare right now. I spent hours debugging this, diving deep into kernel logs, GPU drivers, and display routing architectures. 

**The good news?** I figured it out. And I'm going to share the complete solution with you.

---

## Understanding the Enemy: What's Actually Happening?

Before we dive into the fix, let's understand why this happens. It's not a hardware defect ‚Äî it's a *configuration problem* with how Linux handles hybrid graphics on this specific laptop.

### The Hybrid Graphics Dance

The ASUS G14 2025 has two GPUs:
- **AMD Radeon 890M** (integrated GPU, built into the CPU)
- **NVIDIA RTX 5070 Ti** (discrete GPU, the powerhouse)

Here's where it gets interesting: these GPUs aren't created equal in terms of display connectivity.

```
Internal Display ‚Üí Physically wired to ‚Üí AMD iGPU
External Ports   ‚Üí Physically wired to ‚Üí NVIDIA dGPU
```

The laptop has what's called a **MUX switch** (multiplexer) that can change these connections, but by default, this is how it's wired.

### The Fatal Configuration

When I installed Ubuntu with the NVIDIA proprietary drivers and used the default `prime-select on-demand` mode, here's what was happening:

1. **Desktop rendering:** NVIDIA RTX 5070 Ti (wrong choice!)
2. **Internal display connection:** AMD Radeon 890M
3. **The problem:** Frames rendered by NVIDIA had to be *copied* to AMD, then sent to the display

This **cross-GPU frame routing** is inherently unstable. Think of it like asking two drivers to control one car simultaneously ‚Äî chaos is inevitable.

### The Smoking Gun

The fact that my external monitor worked perfectly was the critical clue. External ports are wired directly to NVIDIA, so no frame copying was needed. The instability *only* affected the internal display where cross-GPU routing was happening.

**Mystery solved.** Now let's fix it.

---

## The Solution: Enter supergfxctl

The fix involves using ASUS-specific tools that actually understand the hardware architecture, rather than relying on NVIDIA's generic `prime-select` utility.

### Step 1: Install the ASUS Control Suite

First, we need `supergfxctl` ‚Äî part of the ASUS Linux project's `asusctl` suite. This tool was specifically designed for ASUS ROG laptops and knows how to properly handle the MUX switch and display routing.

```bash
# Add the repository
sudo add-apt-repository ppa:supergfxd/supergfxd
sudo apt update

# Install the packages
sudo apt install supergfxctl asusctl
```

### Step 2: The Module Loading Problem

When I first tried to switch to Hybrid mode with `supergfxctl`, I hit a brick wall:

```bash
sudo systemctl restart supergfxd
# Job for supergfxd.service failed...
```

Checking the logs revealed the culprit:

```bash
sudo journalctl -u supergfxd -n 20
# [ERROR] Modprobe error: could not find module by name='off'
```

Wait, what? A module named "off"?

### Step 3: Hunting Down the Alias Monster

Here's what I discovered: Ubuntu's `nvidia-prime` package creates a file at `/lib/modprobe.d/blacklist-nvidia.conf` with these lines:

```
blacklist nvidia
blacklist nvidia-drm
blacklist nvidia-modeset
alias nvidia off
alias nvidia-drm off
alias nvidia-modeset off
```

Those `alias` lines are the problem. They tell the system that when something tries to load "nvidia", it should load "off" instead. Spoiler alert: there's no kernel module called "off". ü§¶‚Äç‚ôÇÔ∏è

**The fix is simple:**

```bash
# Backup first (always backup!)
sudo cp /lib/modprobe.d/blacklist-nvidia.conf /lib/modprobe.d/blacklist-nvidia.conf.bak

# Remove the problematic alias lines
sudo sed -i '/^alias nvidia/d' /lib/modprobe.d/blacklist-nvidia.conf

# Verify it's clean
cat /lib/modprobe.d/blacklist-nvidia.conf
```

Your file should now only have the `blacklist` directives (which are fine):

```
# Do not modify
# This file was generated by nvidia-prime
blacklist nvidia
blacklist nvidia-drm
blacklist nvidia-modeset
```

### Step 4: Manual Module Loading

Now we can manually load the NVIDIA modules to verify they work:

```bash
# Load the modules in order
sudo modprobe nvidia
sudo modprobe nvidia-modeset
sudo modprobe nvidia-drm

# Check if they loaded
lsmod | grep nvidia

# The moment of truth
nvidia-smi
```

If `nvidia-smi` shows your RTX 5070 Ti, you're golden! üéâ

### Step 5: Configure Hybrid Mode

Edit the supergfxd configuration:

```bash
sudo nano /etc/supergfxd.conf
```

Make sure the mode is set to `"Hybrid"`:

```json
{
  "mode": "Hybrid",
  "vfio_enable": false,
  "vfio_save": false,
  "compute_save": false,
  "always_reboot": false,
  "no_logind": false,
  "logout_timeout_s": 180,
  "hotplug_type": "None"
}
```

Save and reboot:

```bash
sudo reboot
```

---

## Verification: Did It Work?

After rebooting, run these checks:

### 1. Confirm Hybrid Mode

```bash
supergfxctl -g
# Output: Hybrid ‚úì
```

### 2. Desktop Should Use AMD

```bash
glxinfo | grep "OpenGL renderer"
# Output: AMD Radeon Graphics (radeonsi, gfx1150, LLVM 20.1.2...)
```

This is **critical** ‚Äî your desktop is now rendering with AMD, which is directly connected to the internal display. No more cross-GPU routing!

### 3. NVIDIA Should Be Available

```bash
nvidia-smi
```

Should show your RTX 5070 Ti. It might take 2-3 seconds to respond (more on this later).

### 4. Test NVIDIA On-Demand

```bash
__NV_PRIME_RENDER_OFFLOAD=1 __GLX_VENDOR_LIBRARY_NAME=nvidia glxinfo | grep "OpenGL renderer"
# Output: NVIDIA GeForce RTX 5070 Ti Laptop GPU
```

Perfect! NVIDIA is available when you explicitly request it.

---

## How to Use Your GPUs Now

### For Desktop Work (Browsing, Coding, Documents)

**Nothing special needed.** Everything runs on AMD automatically. This is stable, efficient, and gives you great battery life.

### For Machine Learning & CUDA Workloads

CUDA applications automatically use NVIDIA ‚Äî no environment variables needed:

```bash
# PyTorch, TensorFlow, CUDA code
python train_model.py  # Automatically uses NVIDIA

# Docker with GPU
docker run --gpus all pytorch/pytorch:latest python script.py

# Works perfectly!
```

### For OpenGL/Vulkan Applications

Use environment variables to explicitly request NVIDIA:

```bash
__NV_PRIME_RENDER_OFFLOAD=1 __GLX_VENDOR_LIBRARY_NAME=nvidia your_app
```

Or set them permanently in your terminal session:

```bash
export __NV_PRIME_RENDER_OFFLOAD=1
export __GLX_VENDOR_LIBRARY_NAME=nvidia
```

---

## Understanding Power Management

### Why Is nvidia-smi Slow Now?

You might notice that the first time you run `nvidia-smi` after idle time, it takes 2-3 seconds to respond. **This is actually a good sign!**

Here's what's happening:

1. When idle, NVIDIA suspends to save power (~0.5-1W vs ~10-15W)
2. You run `nvidia-smi`
3. GPU wakes up, PCIe link re-initializes (~2-3 seconds)
4. Command executes
5. Subsequent calls are instant (GPU stays awake)

Check the power state:

```bash
cat /sys/bus/pci/devices/0000:64:00.0/power/runtime_status
# Output: suspended (when idle) ‚úì
```

**Important:** This delay does NOT affect your ML workloads. Once your training script starts, the GPU stays awake for the entire session. You only see the delay when checking `nvidia-smi` after the GPU has been idle.

### Battery Life Comparison

| Mode | Battery Life | Use Case |
|------|--------------|----------|
| **Hybrid** (current) | 5-7 hours | Best balance ‚Äî GPU available but sleeping |
| Integrated | 6-8 hours | Maximum battery, no NVIDIA |
| AsusMuxDgpu | 2-3 hours | Gaming mode, always on |

For conferences or travel where you don't need CUDA:

```bash
sudo nano /etc/supergfxd.conf
# Change to: "mode": "Integrated"
sudo reboot
```

Switch back to Hybrid when you need ML capabilities.

---

## Optional: Fine-Tuning

### Kernel Parameters

Add these to `/etc/default/grub` for better stability:

```bash
sudo nano /etc/default/grub
```

Update this line:
```
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash nvidia-drm.modeset=1 nvidia_drm.fbdev=1 amdgpu.dcdebugmask=0x10 nouveau.modeset=0 ibt=off"
```

Apply:
```bash
sudo update-grub
sudo reboot
```

**What these do:**
- `nvidia-drm.modeset=1` ‚Äî Enable kernel mode setting for NVIDIA
- `nvidia_drm.fbdev=1` ‚Äî Enable framebuffer device support
- `amdgpu.dcdebugmask=0x10` ‚Äî AMD debug settings
- `nouveau.modeset=0` ‚Äî Disable open-source nvidia driver
- `ibt=off` ‚Äî Disable Indirect Branch Tracking (compatibility)

### NVIDIA Module Options

Create `/etc/modprobe.d/nvidia.conf`:

```bash
sudo nano /etc/modprobe.d/nvidia.conf
```

Add:
```
options nvidia NVreg_PreserveVideoMemoryAllocations=1
options nvidia NVreg_TemporaryFilePath=/var/tmp
options nvidia-drm modeset=1 fbdev=1
```

These improve suspend/resume behavior and power management.

---

## Troubleshooting

### Still Getting Freezes?

Double-check your configuration:

```bash
# Verify Hybrid mode
supergfxctl -g

# Desktop MUST use AMD
glxinfo | grep "OpenGL renderer"

# Check supergfxd is running
sudo systemctl status supergfxd

# Check for errors
sudo journalctl -u supergfxd -n 50
```

### NVIDIA Modules Won't Load?

Check for remaining alias issues:

```bash
grep -r "alias nvidia" /etc/modprobe.d/ /lib/modprobe.d/
```

If you find any `alias nvidia off` lines, remove them.

### Desktop Still Uses NVIDIA?

Check your session type:

```bash
echo $XDG_SESSION_TYPE
```

**Wayland** (recommended) handles this automatically. If you're on X11, you might need additional xorg.conf configuration (beyond this article's scope).

---

## The Technical Deep Dive

For those who want to understand *why* this works:

### Before (Broken):
```
Desktop Apps ‚Üí NVIDIA GPU (renders frames)
       ‚Üì
   Frame Copy/Route
       ‚Üì
  AMD GPU (receives frames)
       ‚Üì
Internal Display (eDP-1-1)
       ‚Üì
  ‚ùå UNSTABLE - Random Freezes
```

### After (Fixed):
```
Desktop Apps ‚Üí AMD GPU ‚Üí Internal Display
  ‚úì DIRECT PATH, STABLE

ML Workloads ‚Üí NVIDIA GPU ‚Üí Pure Compute
  ‚úì NO DISPLAY INVOLVEMENT
```

The key insight: **Desktop rendering must use the GPU that's physically wired to the display.** Cross-GPU routing for display output is inherently fragile.

NVIDIA is still fully available for:
- CUDA workloads (PyTorch, TensorFlow)
- Docker containers with GPU access
- Scientific computing
- Video encoding/decoding
- Any compute task

It's just not being used for desktop rendering anymore ‚Äî and that's exactly what we want.

---

## Why supergfxctl Over prime-select?

You might be wondering: "Why not just use NVIDIA's `prime-select` tool?"

Here's the problem: `prime-select` is a generic solution that doesn't understand ASUS's MUX switch architecture. It makes assumptions about display routing that don't hold true for this hardware.

`supergfxctl`, on the other hand:
- **Hardware-aware:** Knows about ASUS MUX switches
- **Proper routing:** Configures display paths correctly
- **Integrated with firmware:** Works with ASUS's BIOS/UEFI
- **Mode-specific optimizations:** Handles Integrated/Hybrid/Discrete modes properly

It's the difference between using a generic tool and using one specifically designed for your hardware.

---

## Real-World Performance

### Before the Fix:
- ‚ùå Random freezes every 10-30 minutes
- ‚ùå External monitor required for stability
- ‚ùå Anxiety every time you save work
- ‚ùå Lost productivity from crashes

### After the Fix:
- ‚úÖ **Zero freezes** (running stable for days)
- ‚úÖ Smooth desktop experience on internal display
- ‚úÖ Full NVIDIA CUDA access for ML workloads
- ‚úÖ 5-7 hours battery life
- ‚úÖ External monitors still work perfectly
- ‚úÖ Docker GPU support confirmed working
- ‚úÖ Peace of mind restored üßò

---

## System Requirements & Compatibility

**Tested On:**
- **Laptop:** ASUS ROG Zephyrus G14 2025 (GA403WR)
- **GPU:** NVIDIA RTX 5070 Ti Laptop (12GB)
- **iGPU:** AMD Radeon 890M
- **OS:** Ubuntu 24.04 LTS
- **Kernel:** 6.14.0-37-generic
- **Driver:** nvidia-driver-580-open (580.95.05)

**Should Work On:**
- Other ASUS ROG laptops with hybrid graphics
- Ubuntu 22.04+ (with appropriate kernel/drivers)
- Similar AMD + NVIDIA hybrid systems
- RTX 40/50-series NVIDIA GPUs

**May Require Adjustments:**
- Intel + NVIDIA hybrids (different iGPU)
- Older Ubuntu versions (check driver compatibility)
- Non-ASUS laptops (might need different tools)

---

## The Bigger Picture: Linux on Gaming Laptops

This issue highlights a broader challenge: **gaming laptops with hybrid graphics are tricky on Linux.**

These machines are designed for Windows, where manufacturers provide custom control software. On Linux, we're often reverse-engineering functionality or relying on community projects like [ASUS Linux](https://asus-linux.org/).

**The good news:** The community is actively working on this. Projects like:
- `asusctl` / `supergfxctl` for ASUS
- `system76-power` for System76
- `optimus-manager` for generic systems

...are making hybrid graphics increasingly viable on Linux.

**The takeaway:** If you're buying a laptop for Linux, look for:
1. Hardware with good Linux community support
2. Open-source friendly manufacturers (System76, Tuxedo, Framework)
3. Active community projects for your hardware
4. Or... laptops with single GPU (simpler, but less flexible)

---

## For ML Engineers & Developers

If you're like me and bought this laptop for machine learning work, here's what you need to know:

### CUDA Works Perfectly

```bash
# Test CUDA in Docker
docker run --rm --gpus all nvidia/cuda:12.3.0-base-ubuntu22.04 nvidia-smi

# PyTorch
docker run --rm --gpus all pytorch/pytorch:2.2.0-cuda12.1-cudnn9-runtime \
  python -c "import torch; print(f'CUDA: {torch.cuda.is_available()}')"

# Both work flawlessly ‚úì
```

### Development Workflow

**For coding, debugging, documentation:**
- Runs on AMD (efficient, cool, quiet)
- 5-7 hours unplugged
- Perfect for meetings, coffee shops, planes

**For training models:**
- NVIDIA wakes up automatically
- Full RTX 5070 Ti power (12GB VRAM)
- Plug in for extended sessions

**Best of both worlds!**

---

## Community Help & Resources

### If You Found This Helpful

**Share it!** The more people who know about this solution, the fewer frustrating hours will be wasted debugging freezes.

**Contribute:** If you find improvements or encounter variations of this issue, consider:
- Opening issues on [supergfxctl GitHub](https://github.com/asus-linux/supergfxctl)
- Posting solutions on [r/ASUSROG](https://reddit.com/r/ASUSROG)
- Updating the [Arch Wiki](https://wiki.archlinux.org/) (it's the universal Linux reference)
- Writing your own article with hardware-specific tweaks

### Join the Community

- **ASUS Linux:** [asus-linux.org](https://asus-linux.org/) ‚Äî Discord, docs, support
- **Reddit:** [r/linux_gaming](https://reddit.com/r/linux_gaming), [r/ASUSROG](https://reddit.com/r/ASUSROG)
- **Ubuntu Forums:** [ubuntuforums.org](https://ubuntuforums.org/)
- **NVIDIA Forums:** [forums.developer.nvidia.com](https://forums.developer.nvidia.com/)

### Report Issues

Found a bug in `supergfxctl`? Report it:
- GitHub: [asus-linux/supergfxctl](https://github.com/asus-linux/supergfxctl)

Driver issues with NVIDIA:
- NVIDIA Developer Forums
- Ubuntu Launchpad (for driver packaging)

---

## Final Thoughts

When I first encountered these random freezes, I was ready to give up and go back to Windows. The laptop would freeze mid-sentence while I was typing code. External monitors became my lifeline.

But here's the thing: **this wasn't a hardware problem.** It was a configuration issue that could be solved with the right understanding and tools.

The Linux community has built incredible solutions like `supergfxctl` that make high-end gaming laptops genuinely usable for professional work. Projects like ASUS Linux deserve recognition and support.

**My G14 now runs flawlessly:**
- Stable desktop on Ubuntu 24.04
- Full CUDA for my ML workloads
- Great battery life when I need it
- Powerful GPU when plugged in

If you're struggling with similar issues, I hope this guide saves you the hours of debugging I went through. And if it helped you, pay it forward ‚Äî help the next person who's googling "Ubuntu freeze ASUS G14" in frustration at 2 AM.

---

## Quick Reference Card

**Check GPU Mode:**
```bash
supergfxctl -g
```

**Desktop Renderer:**
```bash
glxinfo | grep "OpenGL renderer"
# Should show: AMD Radeon Graphics
```

**NVIDIA Status:**
```bash
nvidia-smi
```

**NVIDIA On-Demand:**
```bash
__NV_PRIME_RENDER_OFFLOAD=1 __GLX_VENDOR_LIBRARY_NAME=nvidia glxgears
```

**Switch to Integrated (Max Battery):**
```bash
sudo nano /etc/supergfxd.conf  # Change to "Integrated"
sudo reboot
```

**Switch to Hybrid (Balanced):**
```bash
sudo nano /etc/supergfxd.conf  # Change to "Hybrid"
sudo reboot
```

**Check Logs:**
```bash
sudo journalctl -u supergfxd -n 50
```

---

## TL;DR (Too Long; Didn't Read)

**Problem:** ASUS G14 2025 with RTX 5070 Ti randomly freezes on Ubuntu 24.04

**Cause:** Desktop rendering with NVIDIA + internal display on AMD = cross-GPU routing = instability

**Solution:**
1. Install `supergfxctl`: `sudo apt install supergfxctl asusctl`
2. Remove `alias nvidia off` from `/lib/modprobe.d/blacklist-nvidia.conf`
3. Set mode to `"Hybrid"` in `/etc/supergfxd.conf`
4. Reboot

**Result:** Desktop uses AMD (stable), NVIDIA available for compute (ML/CUDA)

**Status:** ‚úÖ Problem solved, system stable, NVIDIA CUDA working perfectly

---

## About the Author

I'm a Senior ML Engineer working on automated site inspection using Boston Dynamics robots and computer vision models. When I'm not debugging GPU drivers, I'm training neural networks for seismic data processing and building robotics systems with ROS.

If you found this helpful or have questions, feel free to reach out!

---

**Last Updated:** December 31, 2025  
**License:** CC0 1.0 (Public Domain) ‚Äî Share freely!  

---

*Did this article help you? Give it a clap üëè and share it with others struggling with Linux hybrid graphics. Let's make premium hardware actually usable on Linux!*

---

**Tags:** #Linux #Ubuntu #NVIDIA #AsusROG #HybridGraphics #GPU #MachineLearning #CUDA #TechTroubleshooting #OpenSource

---

## Comments & Discussion

*Have you encountered similar issues with other ASUS ROG models? Different GPU combinations? Leave a comment below and let's help each other out!*

---

**Related Reading:**
- "Understanding Linux Hybrid Graphics" (coming soon)
- "CUDA Development on Ubuntu: A Complete Guide"
- "Best Practices for ML Workstations on Linux"

---

**GitHub Repository:**  
Complete documentation and scripts: [Coming Soon]

**Support the ASUS Linux Project:**  
[asus-linux.org/support](https://asus-linux.org/)

---

*Thank you for reading! May your GPUs render smoothly and your kernels never panic. üêßüéÆ*
